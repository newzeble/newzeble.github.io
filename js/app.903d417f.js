(function(){"use strict";var e={7621:function(e,t,n){var r=n(7392),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},i=[],s=n(432),c=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};let l=class extends s.w3{};l=c([(0,s.wA)({})],l);var a=l,u=a,f=n(3483),h=(0,f.Z)(u,o,i,!1,null,null,null),d=h.exports,p=n(1655),v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"scroller",staticStyle:{overflow:"auto",height:"98vh"},on:{drop:function(t){return t.preventDefault(),e.onDrop.apply(null,arguments)},dragover:function(e){e.preventDefault()}}},[n("el-drawer",{attrs:{title:"我是标题",direction:"ltr",visible:e.drawer,"with-header":!1},on:{opened:e.onDrawOpen,closed:e.onDrawClose,"update:visible":function(t){e.drawer=t}}},[n("el-row",{staticStyle:{width:"100%"},attrs:{type:"flex"}},[n("el-col",{attrs:{span:12}},[n("el-menu",{staticStyle:{top:"0",position:"sticky",overflow:"hidden"}},e._l(e.bookManager.list,(function(t){return n("el-menu-item",{key:t.name,attrs:{index:t.name},on:{click:function(n){return e.onSelectFile(t)}}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),n("el-col",{attrs:{span:12}},[n("el-menu",{attrs:{"default-active":e.active},on:{"update:defaultActive":function(t){e.active=t},"update:default-active":function(t){e.active=t}}},e._l(e.menu,(function(t,r){return n("el-menu-item",{key:r,attrs:{index:String(r)},on:{click:function(n){return e.onSelectChapter(t.chapterInfo)}}},[e._v(" "+e._s(t.title)+" ")])})),1)],1)],1)],1),n("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.onInfiLoad,expression:"onInfiLoad"}],attrs:{"infinite-scroll-distance":"200","infinite-scroll-disabled":"infDis"}},[n("div",{ref:"content",staticStyle:{margin:"auto",width:"80%"}},[n("div",e._l(e.content,(function(t,r){return n("p",{key:r},[e._v(" "+e._s(t)+" ")])})),0)])])],1)},y=[],g=n(964),m=(n(4898),n(5688),n(4643)),w=n.n(m),x=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};class b{constructor(){(0,g.Z)(this,"list",[]),(0,g.Z)(this,"cache",new Map)}remove(e){this.list.splice(e,1)}add(e){return this.list.push({file:e,name:e.name})}async readIndex(e){const t=await this.read(this.list[e].file);return t}async readWithCache(e){const t=e.name+"_"+String(e.lastModified);let n=this.cache.get(t);return void 0===n&&(n=await this.read(e),this.cache.set(t,n)),n}async read(e){return new Promise(((t,n)=>{const r=new FileReader;r.readAsArrayBuffer(e),r.onload=()=>{const e=r.result;if(!(e instanceof ArrayBuffer))return;const o=e.slice(0,e.byteLength>200?200:e.byteLength),i=w().detect(new Uint8Array(o));if(null===i)return n();const s=new FileReader;s.readAsText(new Blob([e]),i),s.onload=()=>{if("string"!==typeof s.result)return n();t(s.result)},s.onerror=e=>n(e)},r.onerror=e=>n(e)}))}}class S{chapter(e){return this.txt.substring(e.from,e.to).split("\n")}constructor(e){(0,g.Z)(this,"txt",void 0),(0,g.Z)(this,"lineReg",void 0),this.txt=e;var t=["(^s*chapter.{0,6})|((☆、).{0,15})","(^s*第.+[章節卷回集节部篇].*$)","(卷s{0,3}[一二三四五六七八九零十百千○d]{1,9}.*$)","(第[一二三四五六七八九零十百千○d]{1,9}[章節卷回集节部篇]$)","(^[【[s]{0,4}(楔子)?(正文)?[】]s]{0,4}$)","(^[0-9]([.]?)(.*))"].join("|");this.txt=e,this.lineReg=new RegExp(t,"mgi")}chapters(){const e=[],t=this.txt.matchAll(this.lineReg),n=[...t];0===n.length?e.push({from:0,to:this.txt.length,title:"begin"}):n.length>0&&n[0].index&&0!==n[0].index&&e.push({from:0,to:n[0].index,title:"begin"});for(let r=0;r<n.length;r++){const t=n[r],o=t.index;let i=this.txt.length;if(r!==n.length-1){const e=n[r+1];i=e.index}const s=t[0];if(void 0===o)return;if(void 0===i)return;e.push({from:o,to:i,title:s})}return e}}let I=class extends s.w3{constructor(...e){super(...e),(0,g.Z)(this,"bookManager",new b),(0,g.Z)(this,"contentProxy",[]),(0,g.Z)(this,"contentIndex",0),(0,g.Z)(this,"menu",[]),(0,g.Z)(this,"source",null),(0,g.Z)(this,"drawer",!0),(0,g.Z)(this,"active","0"),(0,g.Z)(this,"infDis",!1)}mounted(){this.initKeyBind()}get content(){return this.contentProxy.slice(0,this.contentIndex)}set content(e){this.contentIndex=e.length,this.contentIndex>200&&(this.contentIndex=200,this.infDis=!1),this.contentProxy=e}onDrawOpen(){this.$nextTick((()=>{const e=document.querySelectorAll(".el-menu-item.is-active").item(1);console.log(e),e?.scrollIntoView({block:"center"})}))}onDrawClose(){setTimeout((()=>{this.$nextTick((()=>{const e=this.$refs.content;console.log(e),e.focus({preventScroll:!1})}))}),2e3);const e=this.$refs?.scroller;this.$nextTick((()=>{e.focus()}))}onInfiLoad(){this.contentIndex+=200,this.contentProxy.length<this.contentIndex&&(this.contentIndex=this.contentProxy.length,this.infDis=!0)}async onSelectFile(e){this.source=new S(await this.bookManager.readWithCache(e.file));const t=this.source.chapters();void 0!==t&&(this.menu=t.map((e=>({title:e.title,chapterInfo:e}))),this.onSelectChapter(this.menu[0].chapterInfo))}selectChapterByIndex(e){if(e>=0&&e<this.menu.length){const t=this.menu[e].chapterInfo;this.active=String(e),this.onSelectChapter(t)}}onSelectChapter(e){if(null===this.source)return;this.content=this.source.chapter(e);const t=this.$refs?.scroller;"function"===typeof t?.scrollTo&&t.scrollTo(0,0)}onDrop(e){console.log(e);const t=e.dataTransfer?.files;if(void 0===t)return;let n=0;for(let r=0;r<t.length;r++){const e=t[r];n=this.bookManager.add(e)}this.onSelectFile(this.bookManager.list[n-1])}initKeyBind(){window.onkeydown=e=>{"Space"===e.code&&e.shiftKey&&e.ctrlKey||"ArrowLeft"===e.code||"KeyA"===e.code||"Numpad4"===e.code?this.selectChapterByIndex(Number.parseInt(this.active)-1):"Space"===e.code&&e.ctrlKey||"ArrowRight"===e.code||"KeyD"===e.code||"Numpad6"===e.code?this.selectChapterByIndex(Number.parseInt(this.active)+1):"KeyT"===e.code&&(this.drawer=!this.drawer)}}};I=x([(0,s.wA)({components:{}})],I);var k=I,O=k,Z=(0,f.Z)(O,v,y,!1,null,null,null),_=Z.exports;r["default"].use(p.Z);const P=[{path:"/",name:"home",component:_}],j=new p.Z({mode:"history",base:"/",routes:P});var D=j,T=n(622);r["default"].use(T.ZP);var A=new T.ZP.Store({state:{},getters:{},mutations:{},actions:{},modules:{}}),C=n(6623),R=n.n(C);r["default"].use(R()),r["default"].config.productionTip=!1,new r["default"]({router:D,store:A,render:e=>e(d)}).$mount("#app")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,r,o,i){if(!r){var s=1/0;for(u=0;u<e.length;u++){r=e[u][0],o=e[u][1],i=e[u][2];for(var c=!0,l=0;l<r.length;l++)(!1&i||s>=i)&&Object.keys(n.O).every((function(e){return n.O[e](r[l])}))?r.splice(l--,1):(c=!1,i<s&&(s=i));if(c){e.splice(u--,1);var a=o();void 0!==a&&(t=a)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[r,o,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var o,i,s=r[0],c=r[1],l=r[2],a=0;if(s.some((function(t){return 0!==e[t]}))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(l)var u=l(n)}for(t&&t(r);a<s.length;a++)i=s[a],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},r=self["webpackChunktxtreader"]=self["webpackChunktxtreader"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[998],(function(){return n(7621)}));r=n.O(r)})();
//# sourceMappingURL=app.903d417f.js.map